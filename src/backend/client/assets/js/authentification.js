import{g as r}from"../index.js";document.addEventListener("DOMContentLoaded",function(){const v=document.getElementById("inscription"),g=document.getElementById("connexion"),N=window.matchMedia("(max-width: 530px)").matches;function D(e,t=null){e&&e.preventDefault(),t=t||(e?e.target.getAttribute("href").substring(1):window.location.hash.substring(1));let o,n;t==="connexion"?(o=v,n=g,document.body.classList.remove("parrainage-active")):t==="inscription"&&(o=g,n=v,document.body.classList.remove("parrainage-active")),[v,g].forEach(G=>{r.set(G,{zIndex:-1,display:"none",opacity:0})});let c=150,i=0,q=-150,Y=0;(t==="parrainage"||t==="ajout-photo")&&N&&(c=0,i=200),r.to(o,{opacity:0,x:q,y:Y,scale:.95,duration:.3,ease:"power2.in",onComplete:()=>{o.style.display="none"}}),n.style.display="block",r.fromTo(n,{opacity:0,x:c,y:i,scale:.9},{opacity:1,x:0,y:0,scale:1,duration:.4,ease:"power2.out",onStart:()=>{n.style.zIndex=1},onComplete:()=>{n.style.zIndex=2}})}document.querySelectorAll('a[href="#connexion"], a[href="#inscription"]').forEach(e=>{e.addEventListener("click",D)});function P(e){const t=e.querySelector('button[type="submit"]');if(t){t.disabled=!0;const o=t.querySelector(".arrow-wrapper");o&&(o.style.display="none");let n=t.querySelector(".spinner");n||(n=document.createElement("div"),n.className="spinner",t.appendChild(n)),n.style.display="inline-block",n.style.opacity=1}}function k(e){const t=e.querySelector('button[type="submit"]');if(t){const o=t.querySelector(".spinner");o&&r.to(o,{opacity:0,scale:.8,duration:.3,ease:"power2.in",onComplete:()=>{o.style.display="none",t.disabled=!1;const n=t.querySelector(".arrow-wrapper");n&&(n.style.display="block")}})}}function A(e,t){P(e);const o=new FormData(e);fetch(t,{method:"POST",body:o}).then(n=>n.json()).then(n=>{k(e),n.success?(L(n.message,"success"),n.redirect&&setTimeout(()=>{window.location.href=n.redirect},1500)):L(n.message,"error")}).catch(n=>{console.error("Erreur:",n),k(e),L("Une erreur est survenue lors du traitement de votre demande.","error")})}const w=document.querySelector("#inscription form"),E=document.querySelector("#connexion form");w&&w.addEventListener("submit",function(e){e.preventDefault(),A(w,"/inscription")}),E&&E.addEventListener("submit",function(e){e.preventDefault(),A(E,"/connexion")});function L(e,t="error"){const o=document.getElementById("popup-erreur"),n=document.getElementById("message-erreur"),c=document.getElementById("popup-title");t==="success"?(c.textContent="Succès",o.classList.remove("error"),o.classList.add("success")):(c.textContent="Attention",o.classList.remove("success"),o.classList.add("error")),n.textContent=e,o.classList.remove("hidden"),r.fromTo(o,{opacity:0,y:-20,scale:.8},{opacity:1,y:0,scale:1,duration:.5,ease:"power3.out"}),setTimeout(()=>{r.to(o,{opacity:0,y:-20,duration:.5,ease:"power2.in",onComplete:()=>{o.classList.add("hidden"),o.style.opacity=1,o.style.transform="translate(-50%, -50%)"}})},5e3)}const B=document.getElementById("fermer-popup"),m=document.getElementById("popup-erreur");B&&B.addEventListener("click",()=>{const e=document.getElementById("popup-erreur");r.to(e,{opacity:0,y:-20,duration:.5,ease:"power2.in",onComplete:()=>{e.classList.add("hidden"),e.style.opacity=1,e.style.transform="translate(-50%, -50%)"}})}),window.addEventListener("click",e=>{e.target===m&&r.to(m,{opacity:0,y:-20,duration:.3,ease:"power2.in",onComplete:()=>{m.classList.add("hidden"),m.style.opacity=1,m.style.transform="translateY(0)"}})}),r.set(g,{zIndex:-1,opacity:0,display:"none"}),r.set(v,{zIndex:1,opacity:1,display:"block"}),r.timeline().from(".principal-container",{opacity:0,scale:.9,y:50,duration:.5,ease:"power3.out"}).from(".section-droite",{opacity:0,x:40,duration:.5,ease:"power3.out"},"-=0.3").from("#inscription .header-form h3",{opacity:0,y:20,duration:.4,ease:"power2.out",stagger:.1},"-=0.2").from("#inscription .body-form .input-group, #inscription .body-form .select-group",{opacity:0,y:20,duration:.4,ease:"power2.out",stagger:.1},"-=0.2").from("#inscription .footer-form button",{opacity:0,y:20,duration:.4,ease:"power2.out",stagger:.1},"-=0.2"),document.querySelectorAll(".input-group input, .select-group select").forEach(e=>{e.addEventListener("focus",()=>{r.timeline({defaults:{ease:"power2.inOut"}}).to(e,{x:-10,duration:.1}).to(e,{x:10,duration:.2}).to(e,{x:-5,duration:.15}).to(e,{x:5,duration:.15}).to(e,{x:0,duration:.07,onComplete:()=>{r.to(e,{boxShadow:"0 4px 10px rgba(0, 0, 0, 0.15)",duration:.2,ease:"power2.out"})}})}),e.addEventListener("blur",()=>{r.to(e,{x:0,boxShadow:"none",duration:.3,ease:"power2.in"})})});const s=document.getElementById("inscription-nom"),a=document.getElementById("inscription-prenoms"),d=document.createElement("ul"),l=document.createElement("ul");d.className="suggestions-list",l.className="suggestions-list",s.parentNode.insertBefore(d,s.nextSibling),a.parentNode.insertBefore(l,a.nextSibling);let u={etudiants:[]};fetch("/etudiants.json").then(e=>{if(!e.ok)throw new Error(`Erreur HTTP ${e.status} lors du chargement du JSON`);return e.json()}).then(e=>{if(!e||!Array.isArray(e.etudiants))throw new Error("Format JSON invalide : 'etudiants' doit être un tableau.");u=e}).catch(e=>{y(s,"Erreur chargement données"),y(a,"Erreur chargement données")}),document.addEventListener("click",e=>{const t=e.target===s||e.target===a,o=e.target.closest(".suggestions-list");!t&&!o&&[d,l].forEach(n=>{n.style.display==="block"&&r.to(n,{opacity:0,y:-10,duration:.2,onComplete:()=>n.style.display="none"})})});function b(e){if(!e||!u.etudiants.length)return[];const t=e.toLowerCase(),o=new Set;return u.etudiants.forEach(n=>{n.nom&&n.nom.toLowerCase().includes(t)&&o.add(n.nom)}),Array.from(o)}function x(e,t){if(!t||!e||!u.etudiants.length)return[];const o=e.toLowerCase(),n=t.toLowerCase(),c=new Set;return u.etudiants.forEach(i=>{i.nom&&i.nom.toLowerCase()===n&&i.prenoms&&i.prenoms.toLowerCase().includes(o)&&c.add(i.prenoms)}),Array.from(c)}function h(e,t,o,n){if(t.innerHTML="",o.length===0){t.style.display==="block"&&r.to(t,{opacity:0,y:-10,duration:.2,onComplete:()=>t.style.display="none"});return}o.forEach(c=>{const i=document.createElement("li");i.textContent=c,i.addEventListener("mouseenter",()=>{r.to(i,{backgroundColor:"var(--background-secondary)",duration:.2})}),i.addEventListener("mouseleave",()=>{r.to(i,{backgroundColor:"var(--background-primary)",duration:.2})}),i.addEventListener("click",()=>{e.value=c,r.to(t,{opacity:0,y:-10,duration:.2,onComplete:()=>t.style.display="none"}),typeof n=="function"&&n(c)}),t.appendChild(i)}),t.style.display!=="block"&&(t.style.display="block",t.style.opacity="0",r.fromTo(t,{opacity:0,y:-10},{opacity:1,y:0,duration:.3}),r.fromTo(t.children,{opacity:0,y:-10},{opacity:1,y:0,duration:.3,stagger:.05}))}function y(e,t){const o=e.parentNode.querySelector(".erreur-message");o&&r.to(o,{opacity:0,y:10,duration:.2,onComplete:()=>o.remove()});const n=document.createElement("span");n.className="erreur-message",n.textContent=t,e.parentNode.insertBefore(n,e.nextSibling),e.classList.add("input-error"),r.timeline().to(e,{x:-10,duration:.1}).to(e,{x:10,duration:.1}).to(e,{x:-5,duration:.08}).to(e,{x:5,duration:.08}).to(e,{x:0,duration:.05}),r.fromTo(n,{opacity:0,y:-10},{opacity:1,y:0,duration:.3}),setTimeout(()=>{r.to(n,{opacity:0,y:10,duration:.3,onComplete:()=>{n.remove(),e.classList.remove("input-error")}})},3e3)}s.addEventListener("input",()=>{const e=s.value,t=b(e);h(s,d,t,()=>{a.value="",l.innerHTML="",l.style.display="none"}),e||(l.innerHTML="",l.style.display="none"),s.removeAttribute("invalid");const o=s.parentNode.querySelector(".erreur-message");o&&o.remove()}),s.addEventListener("focus",()=>{const e=s.value,t=b(e);h(s,d,t,()=>{a.value="",l.innerHTML="",l.style.display="none"})}),s.addEventListener("blur",()=>{setTimeout(()=>{if(document.activeElement===d||d.contains(document.activeElement))return;const e=s.value,t=u.etudiants.some(o=>o.nom&&o.nom.toLowerCase()===e.toLowerCase());e&&!t&&b(e).filter(n=>n.toLowerCase()===e.toLowerCase()).length===0?(s.setAttribute("invalid","true"),y(s,"Ce nom est inconnu")):s.removeAttribute("invalid"),d.style.display==="block"&&!s.hasAttribute("invalid")&&r.to(d,{opacity:0,y:-10,duration:.2,onComplete:()=>d.style.display="none"})},200)}),a.addEventListener("input",()=>{const e=a.value,t=s.value,o=x(e,t);h(a,l,o),a.removeAttribute("invalid");const n=a.parentNode.querySelector(".erreur-message");n&&n.remove()}),a.addEventListener("focus",()=>{const e=a.value,t=s.value;if(t){const o=x(e,t);h(a,l,o)}}),a.addEventListener("blur",()=>{setTimeout(()=>{if(document.activeElement===l||l.contains(document.activeElement))return;const e=a.value,t=s.value;if(e&&t){const o=u.etudiants.some(c=>c.nom&&c.nom.toLowerCase()===t.toLowerCase()&&c.prenoms&&c.prenoms.toLowerCase()===e.toLowerCase()),n=x(e,t).filter(c=>c.toLowerCase()===e.toLowerCase());!o&&n.length===0?(a.setAttribute("invalid","true"),y(a,"Prénom inconnu pour ce nom")):a.removeAttribute("invalid")}else a.removeAttribute("invalid");l.style.display==="block"&&!a.hasAttribute("invalid")&&r.to(l,{opacity:0,y:-10,duration:.2,onComplete:()=>l.style.display="none"})},200)});const M=document.getElementById("inscription-mdp"),f=document.getElementById("inscription-confirm-mdp");f.addEventListener("blur",()=>{setTimeout(()=>{const e=f.value;M.value!==e?(f.setAttribute("invalid","true"),y(f,"Les mots de passe ne correspondent pas")):f.removeAttribute("invalid")},200)}),document.querySelectorAll(".input-group").forEach(e=>{const t=e.querySelector('input[type="password"]'),o=e.querySelector(".toggle-password");if(t&&o){const n=o.querySelector(".eye-open"),c=o.querySelector(".eye-closed"),i=r.timeline({paused:!0});i.to(o,{duration:.4,rotation:180,ease:"back.out(1.7)",transformOrigin:"center center"}),i.to(c,{duration:.2,opacity:0,scale:.5,ease:"power2.out"},0),i.to(n,{duration:.3,opacity:1,scale:1,ease:"power2.out"},0);const q=()=>{r.to(t,{duration:.12,filter:"blur(5px)",ease:"power1.out",onComplete:()=>{t.type=t.type==="password"?"text":"password",t.type==="text"?i.play():i.reverse(),r.to(t,{duration:.3,filter:"blur(0px)",ease:"power1.out"})}})};o.addEventListener("click",function(){q()})}});const p=document.querySelector(".upload-zone"),S=document.getElementById("photo-profil"),C=document.querySelector(".preview-container"),F=document.getElementById("preview-image"),O=document.querySelector(".remove-preview"),T=document.querySelector(".error-message");function z(e){return["image/jpeg","image/png","image/gif"].includes(e.type)}function I(e){if(!z(e)){T.classList.add("active"),S.value="";return}T.classList.remove("active");const t=new FileReader;t.onload=function(o){F.src=o.target.result,C.classList.add("active"),r.from(C,{opacity:0,y:20,duration:.3,ease:"power2.out"})},t.readAsDataURL(e)}["dragenter","dragover","dragleave","drop"].forEach(e=>{p.addEventListener(e,H,!1)});function H(e){e.preventDefault(),e.stopPropagation()}["dragenter","dragover"].forEach(e=>{p.addEventListener(e,j,!1)}),["dragleave","drop"].forEach(e=>{p.addEventListener(e,W,!1)});function j(){p.classList.add("drag-over")}function W(){p.classList.remove("drag-over")}p.addEventListener("drop",U,!1);function U(e){const o=e.dataTransfer.files[0];I(o)}S.addEventListener("change",function(){this.files&&this.files[0]&&I(this.files[0])}),O.addEventListener("click",function(){S.value="",C.classList.remove("active"),T.classList.remove("active")})});
